\section{Experimentación y/o validación}

En base a los casos de uso implementados analizamos cada ecosistema en las siguientes categorías: costos, experiencia de desarrollo, viabilidad y performance, con el objetivo de compararlas y ver las ventajas y desventajas de cada uno.

\subsection{Costos}
¿Cuánto nos cuesta desplegar y mantener un servicio en cada ecosistema?

\subsubsection{IPFS}

\subsubsection{Blockchain}

\paragraph{Swarm}
Al deployar el sitio web es necesario contar con \textit{postage stamps} que son la manera de pagar por el uso del almacenamiento en Swarm. Cada actualización que se realice al sitio requiere de \textit{postage stamps} y, además, estos tienen fecha de vencimiento por lo que es necesario volver a pagar frecuentemente. Hay que tener en cuenta que dichos \textit{postage stamps} se pagan en la criptomoneda BZZ que fluctúa de valor con respecto al dólar estadounidense. La obtención del sitio web no requiere de costo alguno, por lo que desde el punto de vista de un usuario lector de la aplicación no sería necesario pagar.

<TODO: medir cuánto es el costo aproximado en USD o BZZ>

\paragraph{Ethereum}
Se utiliza la moneda ETH para pagar por el despliegue de cada transacción, esto incluye tanto el despliegue de cada \textit{smart contract} como también la edición de un artículo (en el caso del repositorio de conocimiento). Por lo tanto, el usuario final de la aplicación termina pagando por creación y edición de cada artículo en el repositorio de conocimiento, y por cada mensaje enviado en el mensajero en tiempo real. Por otro lado, para las operaciones de lectura no se tiene que pagar nada.

\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{img/aw-eth-bytes-articulo-incremental.png}
    \caption{Tiempo y gas usado al crear artículos con tamaño de bytes creciente}
    \label{fig:aw-eth-bytes-articulo-incremental.png}
\end{figure}

\subsection{Experiencia de desarrollo} % Developer Experience

¿Qué tan fácil es desplegar en cada ecosistema?

\subsubsection{IPFS}

\subsubsection{Blockchain}

\paragraph{Swarm}
En Swarm existe la herramienta de terminal \href{https://github.com/ethersphere/swarm-cli}{swarm-cli} con la cual se puede interactuar con un nodo de Swarm. También el equipo de Swarm provee una Github Action que permite la posibilidad de automatizar el despliegue generando un pipeline que utilice dicha herramienta.

En cuanto a un ambiente de pruebas o \textit{staging}, si bien no existe un \textit{gateway} público que interactúe con la \textit{testnet}, es posible levantar uno propio que sí lo haga apuntando a la \textit{testnet} de Sepolia usando la herramienta \href{https://github.com/ethersphere/gateway-proxy}{gateway-proxy}.

\paragraph{Ethereum}
Con la librería web3.js se puede interactuar con un nodo de Ethereum y realizar un despliegue de la aplicación. Además, con las herramientas de Hardhat se puede levantar una red de prueba que facilita el desarrollo local.

\subsection{Viabilidad} 

¿Que tan viable es crear una aplicación comunitaria para cada uno de estos ecosistemas?

\subsubsection{IPFS}

\subsubsection{Blockchain}

\paragraph{Swarm}
Resulta más conveniente para sitios web o recursos estáticos, al igual que IPFS. Por otro lado, al ser una tecnología de almacenamiento no es posible la ejecución de código. 

A diferencia de IPFS, Swarm cuenta con incentivos incluidos (por medio de la moneda BZZ), esto significa que para deployar contenido en la red es necesario pagar. Al hacerlo te asegura que el mismo va a estar disponible durante el tiempo equivalente al costo pagado, es decir, que no es necesario pinear los archivos puesto que se encuentran en la red con un TTL.

\paragraph{Ethereum}
Su punto fuerte es la ejecución de código, por lo cual es útil para funcionar como backend de aplicaciones web. Como hemos visto, por el costo de almacenamiento de los smart contracts, no es recomendable para recursos como imágenes, videos o incluso strings de texto muy largos como lo realizado en el repositorio de conocimiento. 

Los eventos pueden resultar útil para la interacción en tiempo real requerida en el mensajero, pero lo positivo de esto queda opacado por el hecho de necesitar pagar por cada interacción, en el caso del mensajero por cada mensaje enviado. Esto se puede volver costoso rápidamente, además de tedioso al momento de utilizar la aplicación. Se pueden explorar alternativas para reducir esta fricción, como por ejemplo, que el contrato tenga un balance de tokens para ser gastados, lo cual haría que el usuario no tenga que confirmar cada transacción de mensaje enviado si no que directamente el contrato lo extrae de su balance; entre otras posibilidades.

\subsection{Performance}

\subsubsection{IPFS}

La performance en IPFS depende de algunas variables que están fuera de nuestro alcance. Entre ellas se encuentran:
 - Uso de cache por parte de nodos de IPFS o gateways cuando se recupera un archivo.
 - Cercanía al nodo correspondiente a la hora de publicar un CID en la Distributed Hash Table.
 - Configuración y capacidades del nodo que tiene el contenido que se requiere.
 - Cantidad de nodos alojando el contenido que se requiere.

 Pese a esto, se puede minimizar el efecto de estas variables en la medida final sin distorsionar las métricas obtenidas. Más adelante se verán las maneras en las que se puede lidiar con estas variables.

\paragraph{Sitio Web Informativo}
La métrica que se decidió medir es la del \textbf{tiempo que tarda un nodo en desplegar un sitio web o contenido}. Para ello, se creó un clúster con un único nodo y un repositorio Git con contenido de distinta forma.

\subparagraph{Obtención de las métricas} En este caso, el proceso de despliegue se contiene dentro del contenedor \texttt{watcher}. Para medir el tiempo real que transcurre en cada paso del despliegue, se utilizó el comando de GNU \texttt{time} para cada paso, y el resultado es sumado para obtener el tiempo total que tardó desplegar el contenido.

\subparagraph{Archivos de prueba utilizados} Las métricas obtenidas se lograron ajustando dos variables: el tamaño total del contenido, y la cantidad de archivos del mismo. Los archivos en sí fueron generados repitiendo un \texttt{UUID} hasta alcanzar el número de bytes deseados. Se utilizó este tipo de identificador para asegurar de que ningún archivo permanezca en alguna caché, y a su vez no se repitan los CID entre archivos de la misma prueba.

%TODO: Agregar métricas de IPFS y una conclusión al respecto.

\paragraph{Astrawiki}

Las métricas tanto de Astrawiki como Astrachat se ven muy relacionadas, debido a que el grueso del trabajo relacionado a IPFS se realiza con su biblioteca en común, AstraDB. Por ejemplo, el tiempo que tarda un nodo en obtener una nueva versión de un articulo es el similar al que tarda un nodo en recibir un mensaje. Por ello, se prefirió complementar las métricas obtenidas para acentuar el uso específico de AstraDB de cada caso de uso, y evitar métricas repetidas. 

\paragraph{Astrachat}

\subsubsection{Blockchain}

\paragraph{Astrachat-eth}

Las siguientes métricas corresponden a Astrachat. Se obtuvieron levantando una instancia local de Hardhat \cite{hardhat} y ejecutando 850 muestras, 3 veces cada una y con 3 mensajes de largo distinto:

\begin{itemize}
    \item \textit{short}: mensaje de 1 palabra. \textit{Lorem}
    \item \textit{medium}: mensaje de 10 palabras. \textit{Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam elementum.}
    \item \textit{large}: mensaje de 30 palabras. \textit{Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam ex risus, porttitor sed lacus id, egestas lobortis purus. Curabitur consectetur metus ut est vehicula egestas. Class aptent taciti sociosqu ad.}
\end{itemize}

El tamaño de las palabras elegidas representa el largo de los mensajes más comunes que suelen enviarse en un chat.

A partir de los datos obtenidos se calcularon el máximo (\textbf{Max}), mínimo (\textbf{Min}), la media (\textbf{Mean}), el desvío estándar (\textbf{Std}) y la mediana (\textbf{Median}).

\subparagraph{Tiempo en enviar un mensaje}

La primer métrica tomada corresponde al tiempo que tarda en enviarse un mensaje.

\setlength\tabcolsep{1pt}
\begin{table}[!htbp]
    \centering
    % \begin{tabular}{|m{5em}|m{5em}|}
    \begin{tabular}{|*4{m{5em}|}}
    \hline
    & \textbf{short} & \textbf{medium} & \textbf{large} \\
    \hline
    \textbf{Max} & 10.93 ms & 10.34 ms & 10.68 ms \\
    \hline
    \textbf{Mean} & 6.12 ms & 6.26 ms & 6.44 ms \\
    \hline
    \textbf{Min} & 5.09 ms & 5.24 ms & 5.36 ms \\
    \hline
    \textbf{Std} & 0.74 ms & 0.60 ms & 0.70 ms \\
    \hline
    \textbf{Median} & 6.01 ms & 6.20 ms & 6.37 ms\\
    \hline
    \end{tabular}
    \caption{Tiempo en enviar un mensaje}
\end{table}

Los tiempos entre los tamaños de mensajes no varían demasiado.

\subparagraph{Gas usado para enviar un mensaje}

La siguiente tabla muestra el valor (en ETH y USD) de enviar el mismo mensaje corto. El precio tomado para la conversión de ETH a dólar es el de la fecha del 5 de junio de 2025 a las 19:00hs de \$2439.17 de la página \href{https://coinmarketcap.com/currencies/ethereum/}{Coinmarketcap}.

\setlength\tabcolsep{1pt}
\begin{table}[H]
    \centering
    \begin{tabular}{|l|ll|ll|ll|}
    \hline
     & \multicolumn{2}{c|}{\textbf{short}} & \multicolumn{2}{c|}{\textbf{medium}} & \multicolumn{2}{c|}{\textbf{large}} \\ \hline
     & \multicolumn{1}{c|}{\textbf{ETH}} & \multicolumn{1}{c|}{\textbf{USD}} & \multicolumn{1}{c|}{\textbf{ETH}} & \multicolumn{1}{c|}{\textbf{USD}} & \multicolumn{1}{c|}{\textbf{ETH}} & \multicolumn{1}{c|}{\textbf{USD}} \\
     \hline
    \textbf{Max} & \multicolumn{1}{l|}{0.00042043} & 1.03 & \multicolumn{1}{l|}{0.00060668} & 1.48 & \multicolumn{1}{l|}{0.00085774} & 2.09 \\
    \hline
    \textbf{Mean} & \multicolumn{1}{l|}{0.00034257} & 0.84 & \multicolumn{1}{l|}{0.00051325} & 1.25 & \multicolumn{1}{l|}{0.00074335} & 1.81 \\
    \hline
    \textbf{Min} & \multicolumn{1}{l|}{0.00034221} & 0.83 & \multicolumn{1}{l|}{0.00051274} & 1.25 & \multicolumn{1}{l|}{0.00074264} & 1.81 \\
    \hline
    \textbf{Std} & \multicolumn{1}{l|}{3.31e-06} & 0.01 & \multicolumn{1}{l|}{4.34e-06} & 0.01 & \multicolumn{1}{l|}{5.79e-06} & 0.01 \\
    \hline
    \textbf{Median} & \multicolumn{1}{l|}{0.00034221} & 0.83 & \multicolumn{1}{l|}{0.00051274} & 1.25 & \multicolumn{1}{l|}{0.00074264} & 1.81 \\
    \hline
    \end{tabular}
    \caption{Precio y gas usado para enviar un mensaje}
\end{table}

Según los resultados obtenidos se puede decir que costaría 1 dólar cada mensaje enviado.

\subparagraph{Tiempo en obtener mensajes}

Para esta métrica se tomó el tiempo en obtener todos los mensajes para un chat el cual iba teniendo cada vez más mensajes (desde 0 hasta 1000 mensajes). El gráfico muestra como el tiempo (en milisegundos) se va incrementando a medida que hay más mensajes en el chat.

\begin{figure}[h!]
    \centering
    \includegraphics[width=1\linewidth]{img/blockchain-get-message-graphic.png}
    \caption{Tiempo para obtener mensajes de un chat según el tamaño del chat}
    \label{fig:blockchain-get-message-graphic.png}
\end{figure}

% TODO: Cambiar imagen

\subparagraph{Tiempo entre enviar y recibir un mensaje (mismo usuario)}

En esta métrica se midió el tiempo que tarda en un mensaje desde que es enviado a ser recibido por el canal de escucha de nuevos mensajes para un mismo usuario.

\setlength\tabcolsep{1pt}

\begin{table}[H]
    \centering
    \begin{tabular}{|*4{m{5em}|}}
    \hline
     & \textbf{short} & \textbf{medium} & \textbf{large} \\
    \hline
    \textbf{Max} & 38.12 ms & 28.97 ms & 24.66 ms \\
    \hline
    \textbf{Mean} & 5.42 ms & 5.76 ms & 5.76 ms \\
    \hline
    \textbf{Min} & 4.26 ms & 4.31 ms & 4.46 ms \\
    \hline
    \textbf{Std} & 1.62 ms & 1.74 ms & 0.94 ms \\
    \hline
    \textbf{Median} & 4.66 ms & 5.05 ms & 5.6 ms \\
    \hline
    \end{tabular}
    \caption{Tiempo en enviar y recibir un mensaje (mismo usuario)}
\end{table}

\subparagraph{Tiempo entre enviar y recibir un mensaje (distintos usuarios)}

Esta métrica calcula el tiempo que tarda un segundo usuario en recibir un mensaje enviado por un primer usuario.

\setlength\tabcolsep{1pt}
\begin{table}[H]
    \centering
    \begin{tabular}{|*4{m{5em}|}}
    \hline
     & \textbf{short} & \textbf{medium} & \textbf{large} \\
    \hline
    \textbf{Max} & 13.19 ms & 10.92 ms & 13.95 ms \\
    \hline
    \textbf{Mean} & 5.61 ms & 5.84 ms & 5.96 ms \\
    \hline
    \textbf{Min} & 4.59 ms & 4.53 ms & 4.65 ms \\
    \hline
    \textbf{Std} & 0.97 ms & 1.28 ms & 0.72 ms \\
    \hline
    \textbf{Median} & 5.53 ms & 5.06 ms & 5.89 ms \\
    \hline
    \end{tabular}
    \caption{Tiempo en enviar y recibir un mensaje (distintos usuarios)}
\end{table}

% \begin{table}[!htbp]
%     \centering
%     \begin{tabular}{|m{5em}|m{5em}|}
%     \hline
%     \textbf{Max} & 13.46 ms \\
%     \hline
%     \textbf{Mean} & 5.75 ms \\
%     \hline
%     \textbf{Min} & 4.68 ms \\
%     \hline
%     \textbf{Std} & 0.93 ms \\
%     \hline
%     \textbf{Median} & 5.27 ms \\
%     \hline
%     \end{tabular}
%     \caption{Tiempo en enviar y recibir un mensaje (distintos usuarios)}
% \end{table}

\subsection{Resumen}

\setlength\tabcolsep{1pt}
\begin{table}[H]
    \centering
    \begin{tabular}{||m{7em}|m{14em}|m{14em}||}
    \hline
     & \textbf{IPFS} & \textbf{Blockchain} \\
    \hline\hline
    \textbf{Costos} & Bajos o nulos & Escala con el uso de la aplicación \\
    \hline
    \textbf{Desarrollo} &  & Existen herramientas que facilitan el desarrollo y el despliegue \\
    \hline
    \textbf{Viabilidad} & & Sitios estáticos y aplicaciones CRUD \\
    \hline
    \textbf{Performance} & & \\
    \hline
    \end{tabular}
    \caption{Comparación entre los ecosistemas de IPFS y Blockchain}
\end{table}

% TODO: Poner la tabla, hay una en el notion 